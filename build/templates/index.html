<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#0a0a0a">
  <title>Big Tech News</title>
  <meta name="description" content="Curated big tech news ranked by relevance. Updated daily.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class="header">
    <div class="container header-inner">
      <a href="index.html" class="logo">Big Tech News</a>
      <div class="header-actions">
        <button class="search-toggle" id="searchToggle" aria-label="Search">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
          </svg>
        </button>
        <button class="menu-toggle" id="menuToggle" aria-label="Menu">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>
    <div class="search-bar" id="searchBar">
      <div class="container">
        <input type="search" id="searchInput" placeholder="Search articles..." autocomplete="off">
        <button class="search-close" id="searchClose">Cancel</button>
      </div>
    </div>
  </header>

  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">Recent</div>
      <ul class="sidebar-list">
        {{sidebarRecentHTML}}
      </ul>
    </div>
    <div class="sidebar-section">
      <button class="sidebar-toggle" data-target="weeklyList">
        <span class="sidebar-title">Weekly Digests</span>
        <svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
      </button>
      <ul class="sidebar-list collapsible" id="weeklyList">
        {{sidebarWeeklyHTML}}
      </ul>
    </div>
    <div class="sidebar-section">
      <button class="sidebar-toggle" data-target="monthlyList">
        <span class="sidebar-title">Monthly Digests</span>
        <svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
      </button>
      <ul class="sidebar-list collapsible" id="monthlyList">
        {{sidebarMonthlyHTML}}
      </ul>
    </div>
  </nav>

  <main>
    <div class="search-results" id="searchResults"></div>

    <section class="top-stories">
      <div class="container">
        <div class="update-time">Updated {{lastUpdated}}</div>
        <div class="section-header">
          <h2 class="section-title">Top Stories</h2>
          {{#latestDailyLink}}<a href="{{latestDailyLink}}" class="view-all">Full digest →</a>{{/latestDailyLink}}
        </div>
        {{heroHTML}}
      </div>
    </section>

    <section class="week-digest">
      <div class="container">
        <div class="section-header">
          <div>
            <h2 class="section-title">This Week So Far</h2>
            <p class="section-subtitle">{{weekDateRange}}</p>
          </div>
          {{#latestWeeklyLink}}<a href="{{latestWeeklyLink}}" class="view-all">Last week →</a>{{/latestWeeklyLink}}
        </div>
        <div class="week-grid">
          {{weekToDateHTML}}
        </div>
      </div>
    </section>

    <section class="today-section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">More Today</h2>
          {{#latestDailyLink}}<a href="{{latestDailyLink}}" class="view-all">View all →</a>{{/latestDailyLink}}
        </div>
        <div class="news-list">
          {{todayNewsHTML}}
        </div>
      </div>
    </section>

    <section class="archive-section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Browse Archive</h2>
        </div>
        <div class="archive-tabs">
          <button class="archive-tab active" data-tab="daily">Daily</button>
          <button class="archive-tab" data-tab="weekly">Weekly</button>
          <button class="archive-tab" data-tab="monthly">Monthly</button>
        </div>
        <div class="archive-content" id="archiveDaily">{{archiveDailyHTML}}</div>
        <div class="archive-content hidden" id="archiveWeekly">{{archiveWeeklyHTML}}</div>
        <div class="archive-content hidden" id="archiveMonthly">{{archiveMonthlyHTML}}</div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <p>Curated tech news, ranked by relevance.</p>
      <p><a href="https://github.com/IT-Guy007/BigTechNews">Source on GitHub</a></p>
    </div>
  </footer>

  <script>
    // Menu toggle
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');

    menuToggle.addEventListener('click', () => {
      menuToggle.classList.toggle('active');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
    });

    overlay.addEventListener('click', () => {
      menuToggle.classList.remove('active');
      sidebar.classList.remove('open');
      overlay.classList.remove('open');
    });

    // Sidebar collapsible sections
    document.querySelectorAll('.sidebar-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const target = document.getElementById(btn.dataset.target);
        btn.classList.toggle('expanded');
        target.classList.toggle('expanded');
      });
    });

    // Search
    const searchToggle = document.getElementById('searchToggle');
    const searchBar = document.getElementById('searchBar');
    const searchInput = document.getElementById('searchInput');
    const searchClose = document.getElementById('searchClose');
    const searchResults = document.getElementById('searchResults');
    const mainSections = document.querySelectorAll('main > section');

    const articles = {{articlesJSON}};

    searchToggle.addEventListener('click', () => {
      searchBar.classList.add('open');
      searchInput.focus();
    });

    searchClose.addEventListener('click', closeSearch);

    function closeSearch() {
      searchBar.classList.remove('open');
      searchInput.value = '';
      searchResults.innerHTML = '';
      searchResults.classList.remove('active');
      mainSections.forEach(s => s.classList.remove('hidden'));
    }

    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase().trim();
      if (query.length < 2) {
        searchResults.innerHTML = '';
        searchResults.classList.remove('active');
        mainSections.forEach(s => s.classList.remove('hidden'));
        return;
      }

      const matches = articles.filter(a => 
        a.title.toLowerCase().includes(query) ||
        a.source.toLowerCase().includes(query) ||
        (a.keywords && a.keywords.some(k => k.toLowerCase().includes(query)))
      ).slice(0, 20);

      mainSections.forEach(s => s.classList.add('hidden'));
      searchResults.classList.add('active');

      if (matches.length === 0) {
        searchResults.innerHTML = '<div class="container"><p class="no-results">No articles found</p></div>';
        return;
      }

      searchResults.innerHTML = `
        <div class="container">
          <p class="results-count">${matches.length} result${matches.length !== 1 ? 's' : ''}</p>
          <div class="news-list">
            ${matches.map((a, i) => `
              <a href="${a.link}" target="_blank" rel="noopener" class="news-item">
                <span class="news-rank">${i + 1}</span>
                <div class="news-content">
                  <h3 class="news-title">${escapeHtml(a.title)}</h3>
                  <p class="news-meta">${escapeHtml(a.source)}</p>
                </div>
              </a>
            `).join('')}
          </div>
        </div>
      `;
    });

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Archive tabs
    document.querySelectorAll('.archive-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.archive-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.archive-content').forEach(c => c.classList.add('hidden'));
        tab.classList.add('active');
        document.getElementById('archive' + tab.dataset.tab.charAt(0).toUpperCase() + tab.dataset.tab.slice(1)).classList.remove('hidden');
      });
    });

    // Escape key closes search
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && searchBar.classList.contains('open')) {
        closeSearch();
      }
    });
  </script>
</body>
</html>
